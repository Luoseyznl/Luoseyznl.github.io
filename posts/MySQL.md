---
title: MySQL 学习笔记
date: 2025-08-01
category: 渐入佳境
tags: [MySQL, 数据库, SQL]
---

MySQL 是一个开源的关系型数据库管理系统，使用 SQL（结构化查询语言）进行数据操作。

## 目录

---

## 1. MySQL 架构

> **MySQL 的架构分为两层：服务器层和存储引擎层。服务器层负责处理 SQL 语句、连接管理、权限控制等，所有的内置函数和跨存储引擎的功能都在这里实现。而存储引擎层负责数据的实际存储和检索，支持多种存储引擎，如 InnoDB、MyISAM、Memory 等。多个不同的存储引擎可以在同一个 MySQL 实例中共存，共用一个 Server 层。**

![SQL](SQL.drawio.png)

就 SELECT 查询语句，客户端首先发起连接 `mysql -h host -u user -p`，连接器（Connector）检验用户权限，查询缓存（MySQL 8.0后不支持），未命中则进入解析器将 SQL 语句解析为语法树。

在执行查询语句阶段，首先由预处理器（Preprocessor）检查表和字段、展开试图（View）和存储过程（Stored Procedure）、绑定参数等。然后由优化器（Optimizer）生成执行计划，选择最优的索引和连接方式。最后由执行器（Executor）执行查询，与存储引擎（Storage Engine）交互，获取数据。

MySQL 基于 TCP 协议传输数据，连接器负责验证用户名和密码 `mysql -u root -p xxx`、管理用户权限、连接状态等。解析器负责语法分析（提取 Token 和 Keyword）、语法分析（构建语法树）。执行语句的流程分为三个阶段：预处理、优化、执行。预处理阶段负责判断表/字段是否存在，优化阶段负责确定执行方案，执行阶段负责执行 SQL 语句并返回结果。

1. **主键索引查询**：通过主键索引（聚簇索引）直接定位并获取数据行，效率最高。
2. **全表扫描**：当没有可用索引或查询条件无法利用索引时，MySQL 会遍历整张表的所有数据行，效率较低。
3. **索引下推（Index Condition Pushdown, ICP）**：在使用二级索引（非主键索引）时，MySQL 会将部分 WHERE 条件下推到存储引擎层，在扫描索引时提前过滤不满足条件的记录，减少回表次数，提高查询效率。

## 2. 表数据的存储

 MySQL 数据库文件默认在 `/var/lib/mysql/` 目录下。`idb` 文件存储了数据库的元数据，包括表结构、索引信息等。表空间由段、区、页、行组成。段是逻辑上的数据存储单元，区是物理上的数据存储单元，页是最小的数据存储单元。
每个页的大小通常为 16KB。InnoDB 存储引擎使用 B+ 树来存储数据，以区为单位分配空间（将连续的 64 页分配在一起）。

InnoDB 提供 4 种行格式：**Compact**、**Redundant**、**Dynamic** 和 **Compressed**。

![compact](compact.png)

